<script type="text/javascript">
  var gk_isXlsx = false;
  var gk_xlsxFileLookup = {};
  var gk_fileData = {};
  function loadFileData(filename) {
  if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
      try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row =>
              row.some(cell => cell !== '' && cell !== null && cell !== undefined)
          );
          var csv = XLSX.utils.aoa_to_sheet(filteredData);
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
      } catch (e) {
          console.error(e);
          return "";
      }
  }
  return gk_fileData[filename] || "";
  }
</script>
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–¢–∞–π–Ω–∞ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –õ–æ–≥–∞—Ä–∏—Ñ–º–∞: –•–∞–∫–µ—Ä—Å–∫–∞—è –º–∏—Å—Å–∏—è</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="styles/styles.css">
<style>
.wire-point.wire-rect {
    width: 260px;
    min-height: 60px;
    border-radius: 18px;
    background: #181f18;
    color: #00ffea;
    box-shadow: 0 0 10px #00ffea;
    font-size: 1.15em;
    padding: 10px 18px;
    text-align: center;
    border: 3px solid #00ffea;
    transition: box-shadow 0.3s, border-color 0.3s;
    height: auto;
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>
</head>
<body>
<canvas class="matrix" id="matrix"></canvas>
<header>
<div class="header-content">
<img src="https://i.postimg.cc/q74Fdnpr/IMG-20250415-113958.png" alt="Logo" class="logo">
<h1>–¢–∞–π–Ω–∞ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –õ–æ–≥–∞—Ä–∏—Ñ–º–∞: –•–∞–∫–µ—Ä—Å–∫–∞—è –º–∏—Å—Å–∏—è</h1>
</div>
</header>
<main>

<div id="startBlock" style="
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  margin-bottom: 2rem;
">
  <div style="
    border: 6px solid #00ff00;
    border-radius: 24px;
    box-shadow: 0 0 32px #00ff00, 0 0 16px #00ff00 inset;
    background: #181f18;
    padding: 1.5rem;
    display: inline-block;
    ">
    <img src="images/start.png" alt="–°—Ç–∞—Ä—Ç" style="max-width:420px; width:100%; border-radius:18px; display:block;">
  </div>
  <button class="btn" style="margin-top: 1.5rem;" onclick="startPath()">–ù–∞—á–∞—Ç—å –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ</button>
</div>

<section class="scene" id="scene1">
  <h2>–ü—Ä–æ–ø–∞–≤—à–∏–π –≥–µ–Ω–∏–π</h2>
  <p>–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä –õ–æ–≥–∞—Ä–∏—Ñ–º, –ª–µ–≥–µ–Ω–¥–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏, –∑–∞–≥–∞–¥–æ—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∏—Å—á–µ–∑. –ï–≥–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–µ–¥ –≤–µ–¥—ë—Ç –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é "ZeroDivision". –í—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —Ö–∞–∫–µ—Ä, –ø—Ä–∏–∑–≤–∞–Ω–Ω—ã–π —Ä–∞—Å–∫—Ä—ã—Ç—å –ø—Ä–∞–≤–¥—É. –ü–µ—Ä–µ–¥ –≤–∞–º–∏ –∑–∞–ø–µ—Ä—Ç–∞—è –¥–≤–µ—Ä—å, –º–∏–≥–∞—é—â–∏–π —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏. –ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ—é –º–∏—Å—Å–∏—é!</p>
</section>

<section class="scene hidden" id="path1">
<h2>–§–∞–∑–∞ 1 ‚Äì –ü–æ–∏—Å–∫ –¥–æ—Å—Ç—É–ø–∞</h2>
<p>–ü–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–º–æ–¥–∑–∏, —Å–∫—Ä—ã—Ç—ã—Ö –∑–∞ –∑–∞–º–∫–∞–º–∏ —Å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏. –†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–º–∫–∏. –ù–∞–π–¥–∏—Ç–µ –∫–ª—é—á ¬´üîë¬ª!</p>
<div class="search-area" id="search1">
  <div class="search-item locked pos-1" data-hidden="üíæ" 
       onclick="unlockItem(this, '3', 'üíæ', 'log‚ÇÇ(8)')"></div>
  <div class="search-item locked pos-2" data-hidden="üîß" 
       onclick="unlockItem(this, '5', 'üîß', '‚àö(16 + 9)')"></div>
  <div class="search-item locked pos-3" data-hidden="üì±" 
       onclick="unlockItem(this, '2', 'üì±', '‚à´‚ÇÄ¬≤ x dx')"></div>
  <div class="search-item locked pos-4" data-hidden="üñ•Ô∏è" 
       onclick="unlockItem(this, '30', 'üñ•Ô∏è', '5! / 4')"></div>
  <div class="search-item locked pos-5" data-hidden="üñ®Ô∏è" 
       onclick="unlockItem(this, '1', 'üñ®Ô∏è', 'sin(œÄ/2)')"></div>
  <div class="search-item locked pos-6" data-hidden="üì∑" 
       onclick="unlockItem(this, '4', 'üì∑', '2x - 4 = 4')"></div>
  <div class="search-item locked pos-7" data-hidden="üóùÔ∏è" 
       onclick="unlockItem(this, '1', 'üóùÔ∏è', 'e‚Å∞')"></div>
  <div class="search-item locked pos-8" data-hidden="üîë" 
       onclick="unlockItem(this, '2', 'üîë', 'log‚ÇÉ(9)')"></div>
</div>
<p id="result1" class="hidden"></p>
<button class="btn back-btn" onclick="goBack(1)">–ù–∞–∑–∞–¥</button>
</section>

<section class="scene hidden" id="path2">
<h2>–§–∞–∑–∞ 2 ‚Äì –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–æ–≤</h2>
<p>–ù–∞ –ø–∞–Ω–µ–ª–∏ —Å–ª–µ–≤–∞ ‚Äî —á–∏—Å–ª–∞-–æ—Ç–≤–µ—Ç—ã, —Å–ø—Ä–∞–≤–∞ ‚Äî –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –æ—Ç–≤–µ—Ç –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø—Ä–∏–º–µ—Ä—É. –ü—Ä–æ–≤–æ–¥–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞—Ç—å, –ø–æ–∫–∞ –≤—Å–µ –ø–∞—Ä—ã –Ω–µ –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏.</p>
<div class="wire-task" id="wireTask">

  <!-- –õ–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: –æ—Ç–≤–µ—Ç—ã -->
  <div class="wire-point pos-left1" id="left1" onmousedown="startDraggingWire('v1', this, event)" onmouseup="stopDraggingWire(this)">3</div>
  <div class="wire-point pos-left2" id="left2" onmousedown="startDraggingWire('v2', this, event)" onmouseup="stopDraggingWire(this)">4</div>
  <div class="wire-point pos-left3" id="left3" onmousedown="startDraggingWire('v3', this, event)" onmouseup="stopDraggingWire(this)">121/3</div>
  <div class="wire-point pos-left4" id="left4" onmousedown="startDraggingWire('v4', this, event)" onmouseup="stopDraggingWire(this)">-7</div>
  <div class="wire-point pos-left5" id="left5" onmousedown="startDraggingWire('v5', this, event)" onmouseup="stopDraggingWire(this)">1</div>
  <div class="wire-point pos-left6" id="left6" onmousedown="startDraggingWire('v6', this, event)" onmouseup="stopDraggingWire(this)">3.5</div>

  <!-- –ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞: –ø—Ä–∏–º–µ—Ä—ã (–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏, –Ω–æ wire-point!) -->
  <div class="wire-point wire-rect pos-right1" id="right4" data-equation="3^(2x-1) = 27^(x+2)">
    3^(2x-1)=27^(x+2)
  </div>
  <div class="wire-point wire-rect pos-right2" id="right1" data-equation="log‚ÇÑ(2x + 10) = 2">
    log<sub>4</sub>(2x&nbsp;+&nbsp;10) = 2
  </div>
  <div class="wire-point wire-rect pos-right3" id="right6" data-equation="log‚ÇÉ(4x - 5) = 2">
    log<sub>3</sub>(4x&nbsp;&minus;&nbsp;5) = 2
  </div>
  <div class="wire-point wire-rect pos-right4" id="right3" data-equation="‚àõ(3x + 4) = 5">
    &#8731;(3x&nbsp;+&nbsp;4) = 5
  </div>
  <div class="wire-point wire-rect pos-right5" id="right2" data-equation="2^(x-1) = 8">
    2^(x-1) = 8
  </div>
  <div class="wire-point wire-rect pos-right6" id="right5" data-equation="(x¬≤ - 4)/(x + 2) = 3">
    <span style="display:inline-block;vertical-align:middle;">
      <span style="border-bottom:1px solid #00ffea;display:inline-block;padding:0 4px;">
        x<sup>2</sup>&nbsp;&minus;&nbsp;4
      </span><br>
      <span style="display:inline-block;padding:0 4px;">
        x&nbsp;+&nbsp;2
      </span>
    </span>
    = 3
  </div>
  <canvas class="wire-canvas" id="wireCanvas"></canvas>

</div>
<p id="result2" class="hidden"></p>
<button class="btn back-btn" onclick="goBack(2)">–ù–∞–∑–∞–¥</button>
</section>

<section class="scene hidden" id="path3">
  <h2>–§–∞–∑–∞ 3 ‚Äì –†–µ–±—É—Å</h2>
  <div style="display:flex; flex-direction:column; align-items:center;">
    <img src="images/rebus.png" alt="–†–µ–±—É—Å" class="neon-image big-image">
    <div class="neon-caption">
      <strong>—Ä–∞–∑–≥–∞–¥–∞–π—Ç–µ –†–ï–ë–£–° –∏ –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–ø–æ–¥—Å–∫–∞–∑–∫–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ)</strong>
      <br>
    </div>
  </div>
  <form id="rebusForm" class="answer-form" onsubmit="return handleRebusForm(event)">
    <input type="text" id="rebusInput" class="answer-input" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..." autocomplete="off">
    <button type="submit" class="btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
  </form>
  <p id="result3" class="hidden"></p>
  <button class="btn back-btn" onclick="goBack(3)">–ù–∞–∑–∞–¥</button>
</section>

<section class="scene hidden" id="path4">
  <h2>–§–∞–∑–∞ 4 ‚Äì –®–∏—Ñ—Ä</h2>
  <div style="display:flex; flex-direction:column; align-items:center;">
    <img src="images/h.jpg" alt="–ü–æ–¥—Å–∫–∞–∑–∫–∞" class="neon-image big-image">
    <div class="neon-caption">
      <strong>—Ä–∞–∑–≥–∞–¥–∞–π—Ç–µ —à–∏—Ñ—Ä –Ω–∞ –º–æ–Ω–∏—Ç–æ—Ä–µ –∏ –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∫ —Ñ—Ä–∞–∑–µ:</strong>
      <br>
      <span style="font-size:1.25em; color:#00ffea; margin-top:0.7em; display:inline-block;">"–ª–ø–µ –º–ø–¥–±—Å–π—Ö–Ω–±"</span>
    </div>
  </div>
  <form id="cipherForm" class="answer-form" onsubmit="return handleCipherForm(event)">
    <input type="text" id="cipherInput" class="answer-input" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..." autocomplete="off">
    <button type="submit" class="btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
  </form>
  <p id="result4" class="hidden"></p>
  <button class="btn back-btn" onclick="goBack(4)">–ù–∞–∑–∞–¥</button>
</section>

<section class="scene hidden" id="path5">
  <h2>–§–∞–∑–∞ 5 ‚Äì –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª</h2>
  <div style="display:flex; flex-direction:column; align-items:center; margin-bottom:2rem;">
    <div style="
      border: 6px solid #00ff00;
      border-radius: 24px;
      box-shadow: 0 0 32px #00ff00, 0 0 16px #00ff00 inset;
      background: #181f18;
      padding: 1.5rem;
      display: inline-block;
      ">
      <img src="images/Room1.png" alt="–°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞" style="max-width:420px; width:100%; border-radius:18px; display:block;">
    </div>
    <div class="neon-caption" style="margin-top:1.2rem;">
      <strong>–í—ã –ø–æ–ø–∞–ª–∏ –≤ —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∫–æ–º–Ω–∞—Ç—É</strong>
    </div>
  </div>
  <p>–¢–µ—Ä–º–∏–Ω–∞–ª —Ç—Ä–µ–±—É–µ—Ç –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞. –ù–∞ –∑–∞–ø–∏—Å–∫–µ –Ω–∞–ø–∏—Å–∞–Ω–æ: "–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä –∑–¥–µ—Å—å". –†–µ—à–∏—Ç–µ, –∫–∞–∫ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å:</p>
  <button class="btn" onclick="chooseAction(5, 'hack')">–í–∑–ª–æ–º–∞—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª</button>
  <button class="btn" onclick="chooseAction(5, 'search')">–ò—Å–∫–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—É—Ç—å</button>
  <p id="result5" class="hidden"></p>
  <button class="btn back-btn" onclick="goBack(5)">–ù–∞–∑–∞–¥</button>
</section>

<section class="scene hidden" id="path6">
<h2>–§–∞–∑–∞ 6 ‚Äì –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä</h2>
<p id="finalText"></p>
<button class="btn" id="choice6a" onclick="chooseAction(6, 'save')"></button>
<button class="btn" id="choice6b" onclick="chooseAction(6, 'leave')"></button>
<p id="result6" class="hidden">
  –ù–∞–π–¥–µ–Ω –∫–ª—é—á –ø–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º! –ù–∞ –∫–ª—é—á–µ (üîë) –µ—Å—Ç—å —Ü–∏—Ñ—Ä–∞ "5". –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –µ–≥–æ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å–∫–≤–∞–∂–∏–Ω—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø.
</p>
<div class="inventory-item draggable hidden" id="keyCenter" draggable="true" ondragstart="drag(event)">
  üîë
</div>
<div id="keyDropzonesContainer" class="hidden" style="display: flex; flex-direction: column; align-items: center; gap: 18px; margin-top: 24px; width: 100%;">
  <div class="example-lock">
    <span class="example-text">5¬≤x‚àí4 = 49¬≤‚àíx   </span>
    <span class="eq-sign">=</span>
    <span class="dropzone key-drop" data-answer="2" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–ª—é—á —Å—é–¥–∞"><span class="lock-emoji">üîí</span></span>
  </div>
  <div class="example-lock">
    <span class="example-text">‚àö(x + 1) + 3    </span>
    <span class="eq-sign">=</span>
    <span class="dropzone key-drop" data-answer="5" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–ª—é—á —Å—é–¥–∞"><span class="lock-emoji">üîí</span></span>
  </div>
  <div class="example-lock">
    <span class="example-text">3(7x ‚Äì 1) ‚Äì 6(5x + 2)</span>
    <span class="eq-sign">=</span>
    <span class="dropzone key-drop" data-answer="3" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–ª—é—á —Å—é–¥–∞"><span class="lock-emoji">üîí</span></span>
  </div>
  <div class="example-lock">
    <span class="example-text">log‚ÇÉ(x¬≤ + 72)   </span>
    <span class="eq-sign">=</span>
    <span class="dropzone key-drop" data-answer="4" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–ª—é—á —Å—é–¥–∞"><span class="lock-emoji">üîí</span></span>
  </div>
</div>
<p id="attemptsInfo"></p>
<div id="extraChallenge" class="hidden">
  <button class="btn" id="extraChallengeBtn" onclick="showNextStep(7)">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è</button>
</div>
<button class="btn back-btn" onclick="goBack(6)">–ù–∞–∑–∞–¥</button>
</section>

<section class="scene hidden" id="path7">
<h2>–§–∞–∑–∞ 7 ‚Äì –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–∫—Ü–∏—è</h2>
<p>–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –∑–∞–≤–µ—Ä—à–∏—Ç—å –º–∏—Å—Å–∏—é, —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∞—à–µ–π —Ä–µ–∞–∫—Ü–∏–∏! –ü–æ–π–º–∞–π—Ç–µ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –ø–∞–¥–∞—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!</p>
<canvas id="reactionGame" width="500" height="350" class="game-canvas"></canvas>
<p id="reactionResult" class="hidden"></p>
<button class="btn hidden" id="restartGameBtn" onclick="restartGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
<div>
  <button class="btn" onclick="showNextStep(8)">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É –∑–∞–¥–∞–Ω–∏—é</button>
</div>
<button class="btn back-btn" onclick="goBack(7)">–ù–∞–∑–∞–¥</button>
</section>

<section class="scene hidden" id="path8">
<h2>–§–∞–∑–∞ 8 ‚Äì –ú–∏–≥–∞–ª–∫–∞</h2>
<p>–í–∞—à–∞ –º–∏—Å—Å–∏—è –±–ª–∏–∑–∫–∞ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–∏–≥–∞—é—â—É—é —Ç–æ—á–∫—É –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ!</p>
<canvas id="blinkGame" width="500" height="350" class="game-canvas"></canvas>
<p id="blinkResult" class="hidden"></p>
<button class="btn hidden" id="restartBlinkBtn" onclick="restartBlinkGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
<div>
  <button class="btn" onclick="showEnding(1)">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
</div>
<button class="btn back-btn" onclick="goBack(8)">–ù–∞–∑–∞–¥</button>
</section>

<div class="ending" id="ending1">
<h2>–¢—Ä–∏—É–º—Ñ —Ö–∞–∫–µ—Ä–∞!</h2>
<img src="https://i.postimg.cc/HkBMfR38/file-00000000757061f8a4740df6f148b3f4-conversation-id-67f90bca-1d9c-8012-90ff-ad1c6de7e000-message-i.png" alt="Victory Scene" class="ending-image">
<p>–í–∞—à –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π –≤–∑–ª–æ–º —Å–ø–∞—Å –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞ –õ–æ–≥–∞—Ä–∏—Ñ–º–∞! –í—ã —Ä–∞–∑—Ä—É—à–∏–ª–∏ –ø–ª–∞–Ω—ã "ZeroDivision", –∏ —Ç–µ–ø–µ—Ä—å –º–∏—Ä –Ω–∞—É–∫–∏ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è –≤–∞–º!</p>
<button class="btn menu-btn" onclick="window.location.href='index.html'">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
</div>
<div class="ending sad-ending" id="ending2">
<h2>–¢—è–∂—ë–ª—ã–π –≤—ã–±–æ—Ä...</h2>
<img src="https://i.postimg.cc/HLNyLMqp/file-0000000048f461f88461417d7faf5243-conversation-id-67f90bca-1d9c-8012-90ff-ad1c6de7e000-message-i.png" alt="Failure Scene" class="ending-image">
<p>–í—ã —É—à–ª–∏ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏, —Ä–∞—Å–∫—Ä—ã–≤ —á–∞—Å—Ç—å —Ç–∞–π–Ω "ZeroDivision". –ù–æ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä –æ—Å—Ç–∞–ª—Å—è –≤ –ø–ª–µ–Ω—É, –∏ –µ–≥–æ —Å—É–¥—å–±–∞ —Ç–µ—Ä–∑–∞–µ—Ç –≤–∞—à—É —Å–æ–≤–µ—Å—Ç—å...</p>
<button class="btn menu-btn" onclick="window.location.href='index.html'">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
<button class="btn back-btn-red" onclick="goBackFromEnding()">–ù–∞–∑–∞–¥</button>
</div>
<div class="ending sad-ending" id="ending3">
<h2>–ü—É—Ç—å –æ–¥–∏–Ω–æ—á–∫–∏</h2>
<img src="https://i.postimg.cc/HLNyLMqp/file-0000000048f461f88461417d7faf5243-conversation-id-67f90bca-1d9c-8012-90ff-ad1c6de7e000-message-i.png" alt="Failure Scene" class="ending-image">
<p>–í—ã –ø—Ä–µ–¥–ø–æ—á–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –æ—Å—Ç–∞–≤–∏–≤ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞ –Ω–∞ –º–∏–ª–æ—Å—Ç—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏. "ZeroDivision" –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–≤–æ–∏ —Ç—ë–º–Ω—ã–µ –¥–µ–ª–∞, –∞ –≤—ã —Å–∫—Ä—ã–≤–∞–µ—Ç–µ—Å—å –≤ —Ç–µ–Ω—è—Ö...</p>
<button class="btn menu-btn" onclick="window.location.href='index.html'">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
<button class="btn back-btn-red" onclick="goBackFromEnding()">–ù–∞–∑–∞–¥</button>
</div>
</main>

<canvas id="confettiCanvas" class="effect-canvas"></canvas>
<canvas id="rainCanvas" class="effect-canvas"></canvas>
<script>
let currentStep = 1;
let wiresConnected = {}; 
let activeConnection = null;
let choicesMade = {};
let keyAttempts = 3;
const wireCanvas = document.getElementById('wireCanvas');
const wireCtx = wireCanvas.getContext('2d');
wireCanvas.width = 1100; 
wireCanvas.height = 700; 
function factorial(n) {
if (n === 0 || n === 1) return 1;
return n * factorial(n - 1);
}
function updateAttemptsInfo() {
document.getElementById('attemptsInfo').textContent = "–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: " + keyAttempts;
}
updateAttemptsInfo();
const matrixCanvas = document.getElementById('matrix');
const matrixCtx = matrixCanvas.getContext('2d');
matrixCanvas.width = window.innerWidth;
matrixCanvas.height = window.innerHeight;
const chars = '01';
const fontSize = 18;
const columns = matrixCanvas.width / fontSize;
const drops = Array(Math.floor(columns)).fill(0);
function drawMatrix() {
matrixCtx.fillStyle = 'rgba(0, 0, 0, 0.05)';
matrixCtx.fillRect(0, 0, matrixCanvas.width, matrixCanvas.height);
matrixCtx.fillStyle = '#00ff00';
matrixCtx.font = fontSize + 'px monospace';
drops.forEach((y, i) => {
  const text = chars[Math.floor(Math.random() * chars.length)];
  const x = i * fontSize;
  matrixCtx.fillText(text, x, y);
  if (y > matrixCanvas.height && Math.random() > 0.975) drops[i] = 0;
  drops[i] += fontSize;
});
requestAnimationFrame(drawMatrix);
}
drawMatrix();
function startPath() {
  document.getElementById('scene1').className = 'scene hidden';
  document.getElementById('path1').className = 'scene';
  currentStep = 1;
  // –°–∫—Ä—ã—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –±–ª–æ–∫
  const startBlock = document.getElementById('startBlock');
  if (startBlock) startBlock.style.display = 'none';
}
function goBack(step) {
if (step === 1) {
  document.getElementById(`path${step}`).className = 'scene hidden';
  document.getElementById('scene1').className = 'scene';
  currentStep = 1;
} else {
  showNextStep(step - 1);
}

if (step === 2) {
  wiresConnected = {};
  activeConnection = null;
  wireCtx.clearRect(0, 0, wireCanvas.width, wireCanvas.height);
}
if (step === 6) {
  keyAttempts = 3;
  updateAttemptsInfo();
  document.getElementById('keyCenter').classList.add('hidden');
  document.getElementById('keyDropzonesContainer').classList.add('hidden');
}
}
function goBackFromEnding() {
  document.querySelectorAll('.ending').forEach(e => e.style.display = 'none');

  document.getElementById('path6').className = 'scene';
  currentStep = 6;
}
function unlockItem(element, expectedAnswer, hiddenEmoji, equation) {
let answer = prompt(`–†–µ—à–∏—Ç–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ:\n${equation}\n(–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º):`);
if (answer && answer.trim() === expectedAnswer) {
  element.classList.remove("locked");
  element.textContent = hiddenEmoji;
  if (hiddenEmoji === "üîë") {
    document.getElementById('result1').textContent = "–ö–ª—é—á –Ω–∞–π–¥–µ–Ω! –ß—Ç–æ –¥–∞–ª—å—à–µ?";
    document.getElementById('result1').className = "";
    addChoices(1);
  }
} else {
  alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
}
}
let isDragging = false;
let currentWire = null;
let mouseX = 0;
let mouseY = 0;
let wireStartX = 0;
let wireStartY = 0;
let ropeSim = null;
let ropeAnimFrame = null; 
function startDraggingWire(id, startPoint, event) {
    event.preventDefault();

    if (wiresConnected[id]) {
        const rect = wireCanvas.getBoundingClientRect();
        const clickX = event.clientX - rect.left;
        const clickY = event.clientY - rect.top;
        const wire = wiresConnected[id];

        const startDist = Math.sqrt((clickX - wire.startX) ** 2 + (clickY - wire.startY) ** 2);
        const endDist = Math.sqrt((clickX - wire.endX) ** 2 + (clickY - wire.endY) ** 2);

        if (startDist < 40 || endDist < 40) {
            delete wiresConnected[id];
            drawWires();
            return;
        }
    }
    isDragging = true;
    const rect = wireCanvas.getBoundingClientRect();
    const startRect = startPoint.getBoundingClientRect();
    wireStartX = startRect.left - rect.left + startRect.width / 2;
    wireStartY = startRect.top - rect.top + startRect.height / 2;
    currentWire = {
        id: id,
        startX: wireStartX,
        startY: wireStartY,
        startPoint: startPoint
    };
    startPoint.classList.add('active');
    document.addEventListener('mousemove', handleWireDrag);
    document.addEventListener('mouseup', handleWireRelease);
    startRopeAnimation();
}

document.querySelectorAll('.wire-point[id^="right"]').forEach(point => {
    point.addEventListener('mousedown', function(event) {

        for (let key in wiresConnected) {
            if (wiresConnected[key] && wiresConnected[key].targetId === this.id) {

                const rect = wireCanvas.getBoundingClientRect();
                const clickX = event.clientX - rect.left;
                const clickY = event.clientY - rect.top;
                const wire = wiresConnected[key];
                const endDist = Math.sqrt((clickX - wire.endX) ** 2 + (clickY - wire.endY) ** 2);
                if (endDist < 40) {
                    delete wiresConnected[key];
                    drawWires();
                    return;
                }
            }
        }
    });
});
function startRopeAnimation() {
    if (ropeAnimFrame) return;
    function animate() {
        if (isDragging && currentWire) {
            drawWires();
            ropeAnimFrame = requestAnimationFrame(animate);
        } else {
            ropeAnimFrame = null;
        }
    }
    ropeAnimFrame = requestAnimationFrame(animate);
}
function handleWireDrag(event) {
  if (!isDragging || !currentWire) return;
  event.preventDefault();
  const rect = wireCanvas.getBoundingClientRect();
  mouseX = event.clientX - rect.left;
  mouseY = event.clientY - rect.top;
}
function handleWireRelease(event) {
  if (!isDragging || !currentWire) return;
  event.preventDefault();
  const rect = wireCanvas.getBoundingClientRect();
  let endPoint = document.elementFromPoint(event.clientX, event.clientY);

  // –ò—â–µ–º —Ä–æ–¥–∏—Ç–µ–ª—è wire-point, –µ—Å–ª–∏ –∫–ª–∏–∫ –ø–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
  let target = endPoint;
  while (target && (!target.classList || !target.classList.contains('wire-point') || !target.id.startsWith('right'))) {
      target = target.parentElement;
  }
  if (target && target.classList.contains('wire-point') && target.id.startsWith('right')) {
    const endRect = target.getBoundingClientRect();

    for (let key in wiresConnected) {
      if (wiresConnected[key] && wiresConnected[key].targetId === target.id) {
        delete wiresConnected[key];
      }
    }
    wiresConnected[currentWire.id] = {
      startX: currentWire.startX,
      startY: currentWire.startY,
      endX: endRect.left - rect.left + endRect.width / 2,
      endY: endRect.top - rect.top + endRect.height / 2,
      controlPoint1X: 0,
      controlPoint1Y: 0,
      controlPoint2X: 0,
      controlPoint2Y: 0,
      targetId: target.id 
    };
    updateWirePhysics(wiresConnected[currentWire.id]);
    checkWires();
  }

  currentWire.startPoint.classList.remove('active');
  isDragging = false;
  currentWire = null;
  ropeSim = null;
  if (ropeAnimFrame) {
    cancelAnimationFrame(ropeAnimFrame);
    ropeAnimFrame = null;
  }
  document.removeEventListener('mousemove', handleWireDrag);
  document.removeEventListener('mouseup', handleWireRelease);
  drawWires();
}
function updateWirePhysics(wire) {
    const dx = wire.endX - wire.startX;
    const dy = wire.endY - wire.startY;
    const distance = Math.sqrt(dx * dx + dy * dy);

    const sag = distance * 0.15;

    wire.controlPoint1X = wire.startX + dx * 0.25;
    wire.controlPoint1Y = wire.startY + dy * 0.25 + sag;
    wire.controlPoint2X = wire.startX + dx * 0.75;
    wire.controlPoint2Y = wire.startY + dy * 0.75 + sag;
}

function createRopeSim(startX, startY, endX, endY, segments = 16) {
    const points = [];
    for (let i = 0; i <= segments; i++) {
        const t = i / segments;
        points.push({
            x: startX + (endX - startX) * t,
            y: startY + (endY - startY) * t,
            oldx: startX + (endX - startX) * t,
            oldy: startY + (endY - startY) * t,
            pinned: (i === 0)
        });
    }
    return { points, segments, gravity: 0.7, iterations: 8 };
}
function updateRopeSim(rope, startX, startY, endX, endY) {

    rope.points[0].x = startX;
    rope.points[0].y = startY;
    rope.points[rope.segments].x = endX;
    rope.points[rope.segments].y = endY;

    for (let i = 1; i < rope.segments; i++) {
        let p = rope.points[i];
        let vx = (p.x - p.oldx) * 0.98;
        let vy = (p.y - p.oldy) * 0.98;
        p.oldx = p.x;
        p.oldy = p.y;
        p.x += vx;
        p.y += vy + rope.gravity;
    }

    for (let k = 0; k < rope.iterations; k++) {
        for (let i = 0; i < rope.segments; i++) {
            let p1 = rope.points[i];
            let p2 = rope.points[i + 1];
            let dx = p2.x - p1.x;
            let dy = p2.y - p1.y;
            let dist = Math.sqrt(dx * dx + dy * dy);
            let diff = (dist - 40) / dist; 
            if (i !== 0) {
                p1.x += dx * diff * 0.5;
                p1.y += dy * diff * 0.5;
            }
            if (i !== rope.segments - 1) {
                p2.x -= dx * diff * 0.5;
                p2.y -= dy * diff * 0.5;
            }
        }
    }
}
function drawWirePath(wire, isTemp = false) {
    wireCtx.beginPath();
    wireCtx.strokeStyle = "#00ff00";
    wireCtx.lineWidth = 4;
    wireCtx.lineCap = "round";
    if (isTemp) {

        if (!ropeSim || ropeSim.points.length !== 17) {
            ropeSim = createRopeSim(wire.startX, wire.startY, wire.endX, wire.endY, 16);
        }
        updateRopeSim(ropeSim, wire.startX, wire.startY, wire.endX, wire.endY);
        wireCtx.moveTo(ropeSim.points[0].x, ropeSim.points[0].y);
        for (let i = 1; i < ropeSim.points.length; i++) {
            wireCtx.lineTo(ropeSim.points[i].x, ropeSim.points[i].y);
        }
    } else {

        wireCtx.moveTo(wire.startX, wire.startY);
        wireCtx.bezierCurveTo(
            wire.controlPoint1X, wire.controlPoint1Y,
            wire.controlPoint2X, wire.controlPoint2Y,
            wire.endX, wire.endY
        );
    }

    wireCtx.shadowColor = "#00ff00";
    wireCtx.shadowBlur = 15;
    wireCtx.stroke();
    wireCtx.shadowBlur = 0;
}
function drawWires() {
    wireCtx.clearRect(0, 0, wireCanvas.width, wireCanvas.height);

    for (let id in wiresConnected) {
        const wire = wiresConnected[id];
        drawWirePath(wire);
    }

    if (isDragging && currentWire) {
        drawWirePath({
            startX: currentWire.startX,
            startY: currentWire.startY,
            endX: mouseX,
            endY: mouseY
        }, true);
    } else {
        ropeSim = null; 
    }
}
function checkWires() {
    const requiredConnections = [
        ['v1', 'right1'], // 3 ‚Üí log‚ÇÑ(2x + 10) = 2
        ['v2', 'right2'], // 4 ‚Üí 2^(x-1) = 8
        ['v3', 'right3'], // 7 ‚Üí ‚àõ(3x + 4) = 5
        ['v4', 'right4'], // -7 ‚Üí 3^(2x-1) = 27^(x+2)
        ['v5', 'right5'], // 1 ‚Üí (x¬≤ - 4)/(x + 2) = 3
        ['v6', 'right6']  // 3.5 ‚Üí log‚ÇÉ(4x - 5) = 2
    ];
    let allCorrect = requiredConnections.every(([wireId, targetId]) => {
        return wiresConnected[wireId] && wiresConnected[wireId].targetId === targetId;
    });
    if (allCorrect && Object.keys(wiresConnected).length === 6) {
        setTimeout(() => {
            document.getElementById('wireTask').style.boxShadow = '0 0 20px #00ff00';
            document.getElementById('result2').textContent = "–°—Ö–µ–º–∞ —Å–æ–±—Ä–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ú–æ–∂–Ω–æ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ.";
            document.getElementById('result2').className = "";
            if (!document.getElementById('continueBtn')) {
                const continueBtn = document.createElement('button');
                continueBtn.id = 'continueBtn';
                continueBtn.className = 'btn';
                continueBtn.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                continueBtn.onclick = () => showNextStep(3);
                document.getElementById('result2').appendChild(continueBtn);
            }
        }, 500);
    } else {
        document.getElementById('wireTask').style.boxShadow = '';
        document.getElementById('result2').textContent = '';
    }
}
function handleRebusForm(event) {
  event.preventDefault();
  const answer = document.getElementById('rebusInput').value.trim().toLowerCase();
  if (answer === "–≤–∑–ª–æ–º") {
    document.getElementById('result3').textContent = "–†–µ–±—É—Å —Ä–∞–∑–≥–∞–¥–∞–Ω! –ß—Ç–æ –¥–∞–ª—å—à–µ?";
    document.getElementById('result3').className = "";
    addChoices(3);
  } else {
    document.getElementById('result3').textContent = "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.";
    document.getElementById('result3').className = "";
  }
  return false;
}
function handleCipherForm(event) {
  event.preventDefault();
  const answer = document.getElementById('cipherInput').value.trim().toLowerCase();
  if (answer === "–∫–æ–¥ –ª–æ–≥–∞—Ä–∏—Ñ–º–∞") {
    document.getElementById('result4').textContent = "–®–∏—Ñ—Ä —Ä–∞–∑–≥–∞–¥–∞–Ω! –ß—Ç–æ –¥–∞–ª—å—à–µ?";
    document.getElementById('result4').className = "";
    addChoices(4);
  } else {
    document.getElementById('result4').textContent = "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.";
    document.getElementById('result4').className = "";
  }
  return false;
}
function solveRebus() {
let answer = prompt("–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ —Ä–µ–±—É—Å:");
if (answer && answer.trim().toLowerCase() === "–≤–∑–ª–æ–º") {
  document.getElementById('result3').textContent = "–†–µ–±—É—Å —Ä–∞–∑–≥–∞–¥–∞–Ω! –ß—Ç–æ –¥–∞–ª—å—à–µ?";
  document.getElementById('result3').className = "";
  addChoices(3);
} else {
  alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
}
}
function solveCipher() {
let answer = prompt("–†–∞—Å—à–∏—Ñ—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:\n\"–ª–ø–µ —Ä—Å–ø—Ö–∂—Ç—Ç–ø—Å–± –º–ø–¥–±—Å–π—Ö–Ω–±\"");
if (answer && answer.trim().toLowerCase() === "–∫–æ–¥ –ª–æ–≥–∞—Ä–∏—Ñ–º–∞") {
  document.getElementById('result4').textContent = "–®–∏—Ñ—Ä —Ä–∞–∑–≥–∞–¥–∞–Ω! –ß—Ç–æ –¥–∞–ª—å—à–µ?";
  document.getElementById('result4').className = "";
  addChoices(4);
} else {
  alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
}
}
function drag(event) {
event.dataTransfer.setData("text", event.target.id);
}
function setupKeyDropzones() {
  document.querySelectorAll('.key-drop').forEach(dropzone => {
    dropzone.ondragover = (event) => {
      event.preventDefault();
      dropzone.classList.add('dragover');
    };
    dropzone.ondragenter = (event) => {
      event.preventDefault();
      dropzone.classList.add('dragover');
    };
    dropzone.ondragleave = () => {
      dropzone.classList.remove('dragover');
    };
    dropzone.ondrop = function(event) {
      event.preventDefault();
      dropzone.classList.remove('dragover');
      let itemId = event.dataTransfer.getData("text");
      if (itemId === 'keyCenter') {
        if (this.dataset.answer === "5") {
          this.innerHTML = "üîì";
          showEnding(choicesMade[5] === 'hack' ? (choicesMade[6] === 'save' ? 1 : 3) : 2);
        } else {
          keyAttempts--;
          updateAttemptsInfo();
          if (keyAttempts <= 0) {
            alert("–ü–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã! –ù–∞—á–Ω–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ñ–∞–∑—É –∑–∞–Ω–æ–≤–æ.");
            keyAttempts = 3;
            updateAttemptsInfo();
            document.getElementById('keyCenter').style.display = 'block';
          } else {
            alert("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–∫–≤–∞–∂–∏–Ω–∞! –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: " + keyAttempts);
          }
        }
      }
    };
  });
}
function addChoices(step) {
let result = document.getElementById(`result${step}`);
result.innerHTML += `
  <br><button class="btn" onclick="chooseAction(${step}, 'continue')">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
  <button class="btn" onclick="chooseAction(${step}, 'restart')">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
`;
}
function chooseAction(step, action) {
if (action === 'continue' && step < 5) {
  showNextStep(step + 1);
} else if (action === 'restart') {
  showNextStep(1);
  wiresConnected = {};
  choicesMade = {};
  activeConnection = null;
  wireCtx.clearRect(0, 0, wireCanvas.width, wireCanvas.height);
} else if (step === 5) {
  choicesMade[5] = action;
  document.getElementById('result5').textContent = action === 'hack' ?
    "–¢–µ—Ä–º–∏–Ω–∞–ª –≤–∑–ª–æ–º–∞–Ω! –ó–∞ —Å—Ç–µ–∫–ª–æ–º –≤–∏–¥–Ω–µ–µ—Ç—Å—è —Å–∏–ª—É—ç—Ç –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞." :
    "–í—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ —Ç–∞–π–Ω—ã–π –≤—ã—Ö–æ–¥ —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.";
  document.getElementById('result5').className = "";
  document.getElementById('finalText').textContent = action === 'hack' ?
    "–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä —Ä–∞–Ω–µ–Ω, –Ω–æ –∂–∏–≤. –°–ø–∞—Å—Ç–∏ –µ–≥–æ –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤ –æ–¥–∏–Ω–æ—á–∫—É?" :
    "–î–æ–∫—É–º–µ–Ω—Ç—ã —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –ø—Ä–∞–≤–¥—É, –Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ—Å—Ç–∏. –í–∞—à –≤—ã–±–æ—Ä?";
  document.getElementById('choice6a').textContent = action === 'hack' ? "–°–ø–∞—Å—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞" : "–£–π—Ç–∏ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏";
  document.getElementById('choice6b').textContent = action === 'hack' ? "–û—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ" : "–í–µ—Ä–Ω—É—Ç—å—Å—è –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞";
  showNextStep(6);
} else if (step === 6) {
  choicesMade[6] = action;
  document.getElementById('result6').className = "";
  let key = document.getElementById('keyCenter');
  let dropzones = document.getElementById('keyDropzonesContainer');
  key.classList.remove('hidden');
  dropzones.classList.remove('hidden');
  key.style.display = 'block';
  setupKeyDropzones();
}
}
function showNextStep(step) {
document.getElementById(`path${currentStep}`).className = 'scene hidden';
currentStep = step;
document.getElementById(`path${currentStep}`).className = 'scene';
if (currentStep === 7) {
  startGame();
}
if (currentStep === 8) {
  startBlinkGame();
}
}
function showEnding(ending) {
const key = document.getElementById('keyCenter');
if (key) {
  key.style.display = 'none';
}
document.querySelectorAll('.scene').forEach(scene => {
  scene.className = 'scene hidden';
});
document.getElementById(`ending${ending}`).style.display = 'flex';
if (ending === 1) {
  startConfetti();
} else {
  startRain();
}
}

const confettiCanvas = document.getElementById('confettiCanvas');
const confettiCtx = confettiCanvas.getContext('2d');
confettiCanvas.width = window.innerWidth;
confettiCanvas.height = window.innerHeight;
function startConfetti() {
let particles = [];
function createParticle() {
  return {
    x: Math.random() * confettiCanvas.width,
    y: -10,
    vx: (Math.random() - 0.5) * 6,
    vy: Math.random() * 6 + 3,
    size: Math.random() * 8 + 5,
    life: 150,
    color: `hsl(${Math.random() * 360}, 80%, 60%)`,
    shape: Math.random() < 0.5 ? 'square' : 'circle'
  };
}
function updateParticles() {
  if (particles.length < 100 && Math.random() < 0.3) {
    particles.push(createParticle());
  }
  particles = particles.filter(p => p.life > 0 && p.y < confettiCanvas.height + p.size);
  confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    p.vx += (Math.random() - 0.5) * 0.2;
    p.life--;
    confettiCtx.beginPath();
    confettiCtx.fillStyle = p.color;
    if (p.shape === 'square') {
      confettiCtx.fillRect(p.x - p.size / 2, p.y - p.size / 2, p.size, p.size);
    } else {
      confettiCtx.arc(p.x, p.y, p.size / 2, 0, Math.PI * 2);
      confettiCtx.fill();
    }
  });
  requestAnimationFrame(updateParticles);
}
updateParticles();
}

const rainCanvas = document.getElementById('rainCanvas');
const rainCtx = document.getElementById('rainCanvas').getContext('2d');
rainCanvas.width = window.innerWidth;
rainCanvas.height = window.innerHeight;
function startRain() {
let drops = [];
function createDrop() {
  return {
    x: Math.random() * rainCanvas.width,
    y: -10,
    length: Math.random() * 20 + 10,
    speed: Math.random() * 5 + 5,
    opacity: Math.random() * 0.5 + 0.3
  };
}
function updateDrops() {
  if (drops.length < 80 && Math.random() < 0.4) {
    drops.push(createDrop());
  }
  drops = drops.filter(d => d.y < rainCanvas.height + d.length);
  rainCtx.clearRect(0, 0, rainCanvas.width, rainCanvas.height);
  drops.forEach(d => {
    d.y += d.speed;
    rainCtx.beginPath();
    rainCtx.strokeStyle = `rgba(0, 191, 255, ${d.opacity})`;
    rainCtx.lineWidth = 2;
    rainCtx.moveTo(d.x, d.y);
    rainCtx.lineTo(d.x, d.y + d.length);
    rainCtx.stroke();
  });
  requestAnimationFrame(updateDrops);
}
updateDrops();
}
let gameObjects = [];
let score = 0;
let gameInterval = null;
let gameStartTime = 0;
const gameCanvas = document.getElementById('reactionGame');
const gameCtx = gameCanvas.getContext('2d');
function startGame() {
score = 0;
gameObjects = [];
gameStartTime = Date.now();
document.getElementById('reactionResult').classList.add('hidden');
document.getElementById('restartGameBtn').classList.add('hidden');
gameCanvas.addEventListener('click', gameClick);
gameInterval = setInterval(updateGame, 50);
}
function updateGame() {
const elapsed = Date.now() - gameStartTime;
if (Math.random() < 0.1) {
  gameObjects.push({
    x: Math.random() * (gameCanvas.width - 20),
    y: -20,
    r: 18,
    speed: 2 + Math.random() * 3
  });
}
gameObjects.forEach(obj => {
  obj.y += obj.speed;
});
gameObjects = gameObjects.filter(obj => obj.y - obj.r < gameCanvas.height);
drawGame();
if (elapsed > 10000) {
  endGame();
}
}
function drawGame() {
gameCtx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
gameObjects.forEach(obj => {
  gameCtx.beginPath();
  gameCtx.fillStyle = "#00ff00";
  gameCtx.arc(obj.x, obj.y, obj.r, 0, Math.PI * 2);
  gameCtx.fill();
});
gameCtx.font = "24px Courier New";
gameCtx.fillStyle = "#00ff00";
gameCtx.fillText("–°—á—ë—Ç: " + score, 10, 30);
}
function gameClick(event) {
const rect = gameCanvas.getBoundingClientRect();
const clickX = event.clientX - rect.left;
const clickY = event.clientY - rect.top;
for (let i = 0; i < gameObjects.length; i++) {
  const obj = gameObjects[i];
  const dist = Math.sqrt((clickX - obj.x) ** 2 + (clickY - obj.y) ** 2);
  if (dist < obj.r) {
    score++;
    gameObjects.splice(i, 1);
    break;
  }
}
}
function endGame() {
clearInterval(gameInterval);
gameCanvas.removeEventListener('click', gameClick);
document.getElementById('reactionResult').textContent = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á—ë—Ç: " + score;
document.getElementById('reactionResult').className = "";
document.getElementById('restartGameBtn').classList.remove('hidden');
}
function restartGame() {
startGame();
}
let blinkInterval = null;
let blinkScore = 0;
let blinkGameActive = false;
const blinkCanvas = document.getElementById('blinkGame');
const blinkCtx = blinkCanvas.getContext('2d');
let currentBlink = null;
function startBlinkGame() {
blinkScore = 0;
blinkGameActive = true;
document.getElementById('blinkResult').classList.add('hidden');
document.getElementById('restartBlinkBtn').classList.add('hidden');
blinkCanvas.addEventListener('click', blinkGameClick);
blinkInterval = setInterval(updateBlinkGame, 1000);
setTimeout(endBlinkGame, 10000);
drawBlinkGame();
}
function updateBlinkGame() {
currentBlink = {
  x: Math.random() * (blinkCanvas.width - 40) + 20,
  y: Math.random() * (blinkCanvas.height - 40) + 20,
  r: 18
};
drawBlinkGame();
}
function drawBlinkGame() {
blinkCtx.clearRect(0, 0, blinkCanvas.width, blinkCanvas.height);
if (currentBlink) {
  blinkCtx.beginPath();
  blinkCtx.fillStyle = "#00ff00";
  blinkCtx.arc(currentBlink.x, currentBlink.y, currentBlink.r, 0, Math.PI * 2);
  blinkCtx.fill();
}
blinkCtx.font = "24px Courier New";
blinkCtx.fillStyle = "#00ff00";
blinkCtx.fillText("–°—á—ë—Ç: " + blinkScore, 10, 30);
}
function blinkGameClick(event) {
if (!currentBlink) return;
const rect = blinkCanvas.getBoundingClientRect();
const clickX = event.clientX - rect.left;
const clickY = event.clientY - rect.top;
const dist = Math.sqrt((clickX - currentBlink.x) ** 2 + (clickY - currentBlink.y) ** 2);
if (dist < currentBlink.r) {
  blinkScore++;
  currentBlink = null;
  drawBlinkGame();
}
}
function endBlinkGame() {
clearInterval(blinkInterval);
blinkCanvas.removeEventListener('click', blinkGameClick);
blinkGameActive = false;
document.getElementById('blinkResult').textContent = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á—ë—Ç: " + blinkScore;
document.getElementById('blinkResult').className = "";
document.getElementById('restartBlinkBtn').classList.remove('hidden');
}
function restartBlinkGame() {
startBlinkGame();
}
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'930a4f1c0987b03f',t:'MTc0NDcwODIxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'930a70d04dc9adc3',t:'MTc0NDcwOTU5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9316d42f8c4f53b2',t:'MTc0NDgzOTQ5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>